<script>
  // ==== MÁSCARA DE TELEFONE BR ====
  const onlyDigits = (s) => s.replace(/\D/g, "");

  const formatPhoneBR = (v) => {
    const d = onlyDigits(v).slice(0, 11); // DDD (2) + número (8/9)
    if (!d) return "";
    const dd = d.slice(0, 2);
    const p = d.slice(2);

    if (d.length <= 2) return `(${dd}`;
    if (p.length <= 4) return `(${dd}) ${p}`;
    if (p.length <= 8) return `(${dd}) ${p.slice(0, 4)}-${p.slice(4)}`;
    return `(${dd}) ${p.slice(0, 5)}-${p.slice(5, 9)}`; // (DD) 9xxxx-xxxx
  };

  const tel = document.getElementById("telefone");
  const telRaw = document.getElementById("telefoneRaw");

  // formata enquanto digita / cola
  const applyMask = () => {
    tel.value = formatPhoneBR(tel.value);
    telRaw.value = onlyDigits(tel.value); // guarda só números para o backend
  };

  tel.addEventListener("input", applyMask);
  tel.addEventListener("blur", applyMask);
  tel.addEventListener("paste", () => setTimeout(applyMask)); // garante após colar

  // valida no submit: exige 10 (fixo) ou 11 (celular) dígitos
  document.getElementById("leadForm").addEventListener("submit", (e) => {
    const n = telRaw.value.length;
    if (n !== 10 && n !== 11) {
      e.preventDefault();
      alert("Telefone inválido. Use DDD + número (10 ou 11 dígitos).");
      tel.focus();
      return;
    }
  });

  // inicializa caso venha preenchido por autofill
  applyMask();
</script>
